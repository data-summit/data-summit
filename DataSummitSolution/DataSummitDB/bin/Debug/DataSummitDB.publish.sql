/*
Deployment script for DataSummitDB

This code was generated by a tool.
Changes to this file may cause incorrect behavior and will be lost if
the code is regenerated.
*/

GO
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, QUOTED_IDENTIFIER ON;

SET NUMERIC_ROUNDABORT OFF;


GO
:setvar DatabaseName "DataSummitDB"
:setvar DefaultFilePrefix "DataSummitDB"
:setvar DefaultDataPath "C:\Users\robert.blankson\AppData\Local\Microsoft\VisualStudio\SSDT"
:setvar DefaultLogPath "C:\Users\robert.blankson\AppData\Local\Microsoft\VisualStudio\SSDT"

GO
:on error exit
GO
/*
Detect SQLCMD mode and disable script execution if SQLCMD mode is not supported.
To re-enable the script after enabling SQLCMD mode, execute the following:
SET NOEXEC OFF; 
*/
:setvar __IsSqlCmdEnabled "True"
GO
IF N'$(__IsSqlCmdEnabled)' NOT LIKE N'True'
    BEGIN
        PRINT N'SQLCMD mode must be enabled to successfully execute this script.';
        SET NOEXEC ON;
    END


GO
USE [$(DatabaseName)];


GO
IF EXISTS (SELECT 1
           FROM   [master].[dbo].[sysdatabases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET ARITHABORT ON,
                CONCAT_NULL_YIELDS_NULL ON,
                CURSOR_DEFAULT LOCAL 
            WITH ROLLBACK IMMEDIATE;
    END


GO
IF EXISTS (SELECT 1
           FROM   [master].[dbo].[sysdatabases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET PAGE_VERIFY NONE,
                DISABLE_BROKER 
            WITH ROLLBACK IMMEDIATE;
    END


GO
ALTER DATABASE [$(DatabaseName)]
    SET TARGET_RECOVERY_TIME = 0 SECONDS 
    WITH ROLLBACK IMMEDIATE;


GO
PRINT N'Rename refactoring operation with key 28b2058c-c28f-49b5-a08b-8b46ca9d8108 is skipped, element [dbo].[FunctionAppURLs].[Id] (SqlSimpleColumn) will not be renamed to FunctionAppURLId';


GO
PRINT N'Rename refactoring operation with key 9dbddb34-76dd-4630-8519-0e8ebc1faeb2 is skipped, element [dbo].[Drawings].[BlobName] (SqlSimpleColumn) will not be renamed to BlobURL';


GO
PRINT N'Creating [dbo].[Addresses]...';


GO
CREATE TABLE [dbo].[Addresses] (
    [AddressId]   BIGINT        IDENTITY (1, 1) NOT NULL,
    [NumberName]  NVARCHAR (15) NULL,
    [Street]      NVARCHAR (63) NULL,
    [Street2]     NVARCHAR (63) NULL,
    [Street3]     NVARCHAR (63) NULL,
    [TownCity]    NCHAR (31)    NULL,
    [County]      NCHAR (31)    NULL,
    [CountryId]   SMALLINT      NULL,
    [PostCode]    NVARCHAR (10) NULL,
    [CreatedDate] DATETIME      NULL,
    [UserId]      BIGINT        NULL,
    [CompanyId]   INT           NOT NULL,
    [ContactId]   BIGINT        NULL,
    CONSTRAINT [PK_Address] PRIMARY KEY CLUSTERED ([AddressId] ASC)
);


GO
PRINT N'Creating [dbo].[AspNetRoleClaims]...';


GO
CREATE TABLE [dbo].[AspNetRoleClaims] (
    [Id]         INT            IDENTITY (1, 1) NOT NULL,
    [ClaimType]  NVARCHAR (MAX) NULL,
    [ClaimValue] NVARCHAR (MAX) NULL,
    [RoleId]     NVARCHAR (150) NOT NULL,
    CONSTRAINT [PK_AspNetRoleClaims] PRIMARY KEY CLUSTERED ([Id] ASC)
);


GO
PRINT N'Creating [dbo].[AspNetRoleClaims].[IX_AspNetRoleClaims_RoleId]...';


GO
CREATE NONCLUSTERED INDEX [IX_AspNetRoleClaims_RoleId]
    ON [dbo].[AspNetRoleClaims]([RoleId] ASC);


GO
PRINT N'Creating [dbo].[AspNetRoles]...';


GO
CREATE TABLE [dbo].[AspNetRoles] (
    [Id]               NVARCHAR (150) NOT NULL,
    [ConcurrencyStamp] NVARCHAR (MAX) NULL,
    [Name]             NVARCHAR (256) NULL,
    [NormalizedName]   NVARCHAR (256) NULL,
    CONSTRAINT [PK_AspNetRoles] PRIMARY KEY CLUSTERED ([Id] ASC)
);


GO
PRINT N'Creating [dbo].[AspNetRoles].[RoleNameIndex]...';


GO
CREATE NONCLUSTERED INDEX [RoleNameIndex]
    ON [dbo].[AspNetRoles]([NormalizedName] ASC);


GO
PRINT N'Creating [dbo].[AspNetUserClaims]...';


GO
CREATE TABLE [dbo].[AspNetUserClaims] (
    [Id]         INT            IDENTITY (1, 1) NOT NULL,
    [ClaimType]  NVARCHAR (MAX) NULL,
    [ClaimValue] NVARCHAR (MAX) NULL,
    [UserId]     NVARCHAR (150) NOT NULL,
    CONSTRAINT [PK_AspNetUserClaims] PRIMARY KEY CLUSTERED ([Id] ASC)
);


GO
PRINT N'Creating [dbo].[AspNetUserClaims].[IX_AspNetUserClaims_UserId]...';


GO
CREATE NONCLUSTERED INDEX [IX_AspNetUserClaims_UserId]
    ON [dbo].[AspNetUserClaims]([UserId] ASC);


GO
PRINT N'Creating [dbo].[AspNetUserLogins]...';


GO
CREATE TABLE [dbo].[AspNetUserLogins] (
    [LoginProvider]       NVARCHAR (150) NOT NULL,
    [ProviderKey]         NVARCHAR (150) NOT NULL,
    [ProviderDisplayName] NVARCHAR (MAX) NULL,
    [UserId]              NVARCHAR (150) NOT NULL,
    CONSTRAINT [PK_AspNetUserLogins] PRIMARY KEY CLUSTERED ([LoginProvider] ASC, [ProviderKey] ASC)
);


GO
PRINT N'Creating [dbo].[AspNetUserLogins].[IX_AspNetUserLogins_UserId]...';


GO
CREATE NONCLUSTERED INDEX [IX_AspNetUserLogins_UserId]
    ON [dbo].[AspNetUserLogins]([UserId] ASC);


GO
PRINT N'Creating [dbo].[AspNetUserRoles]...';


GO
CREATE TABLE [dbo].[AspNetUserRoles] (
    [UserId] NVARCHAR (150) NOT NULL,
    [RoleId] NVARCHAR (150) NOT NULL,
    CONSTRAINT [PK_AspNetUserRoles] PRIMARY KEY CLUSTERED ([UserId] ASC, [RoleId] ASC)
);


GO
PRINT N'Creating [dbo].[AspNetUserRoles].[IX_AspNetUserRoles_RoleId]...';


GO
CREATE NONCLUSTERED INDEX [IX_AspNetUserRoles_RoleId]
    ON [dbo].[AspNetUserRoles]([RoleId] ASC);


GO
PRINT N'Creating [dbo].[AspNetUserRoles].[IX_AspNetUserRoles_UserId]...';


GO
CREATE NONCLUSTERED INDEX [IX_AspNetUserRoles_UserId]
    ON [dbo].[AspNetUserRoles]([UserId] ASC);


GO
PRINT N'Creating [dbo].[AspNetUsers]...';


GO
CREATE TABLE [dbo].[AspNetUsers] (
    [Id]                   NVARCHAR (150)     NOT NULL,
    [AccessFailedCount]    INT                NOT NULL,
    [ConcurrencyStamp]     NVARCHAR (MAX)     NULL,
    [Email]                NVARCHAR (256)     NULL,
    [EmailConfirmed]       BIT                NOT NULL,
    [LockoutEnabled]       BIT                NOT NULL,
    [LockoutEnd]           DATETIMEOFFSET (7) NULL,
    [NormalizedEmail]      NVARCHAR (256)     NULL,
    [NormalizedUserName]   NVARCHAR (256)     NULL,
    [PasswordHash]         NVARCHAR (MAX)     NULL,
    [PhoneNumber]          NVARCHAR (MAX)     NULL,
    [PhoneNumberConfirmed] BIT                NOT NULL,
    [SecurityStamp]        NVARCHAR (MAX)     NULL,
    [TwoFactorEnabled]     BIT                NOT NULL,
    [UserName]             NVARCHAR (256)     NULL,
    CONSTRAINT [PK_AspNetUsers] PRIMARY KEY CLUSTERED ([Id] ASC)
);


GO
PRINT N'Creating [dbo].[AspNetUsers].[EmailIndex]...';


GO
CREATE NONCLUSTERED INDEX [EmailIndex]
    ON [dbo].[AspNetUsers]([NormalizedEmail] ASC);


GO
PRINT N'Creating [dbo].[AspNetUsers].[UserNameIndex]...';


GO
CREATE UNIQUE NONCLUSTERED INDEX [UserNameIndex]
    ON [dbo].[AspNetUsers]([NormalizedUserName] ASC);


GO
PRINT N'Creating [dbo].[AspNetUserTokens]...';


GO
CREATE TABLE [dbo].[AspNetUserTokens] (
    [UserId]        NVARCHAR (150) NOT NULL,
    [LoginProvider] NVARCHAR (150) NOT NULL,
    [Name]          NVARCHAR (150) NOT NULL,
    [Value]         NVARCHAR (MAX) NULL,
    CONSTRAINT [PK_AspNetUserTokens] PRIMARY KEY CLUSTERED ([UserId] ASC, [LoginProvider] ASC, [Name] ASC)
);


GO
PRINT N'Creating [dbo].[BlockPositions]...';


GO
CREATE TABLE [dbo].[BlockPositions] (
    [BlockPositionId] TINYINT       IDENTITY (1, 1) NOT NULL,
    [Name]            NVARCHAR (15) NOT NULL,
    [CreatedDate]     DATETIME      NULL,
    [UserId]          BIGINT        NULL,
    CONSTRAINT [PK_BlockPosition] PRIMARY KEY CLUSTERED ([BlockPositionId] ASC)
);


GO
PRINT N'Creating [dbo].[Categories]...';


GO
CREATE TABLE [dbo].[Categories] (
    [CategoryId]  INT           IDENTITY (1, 1) NOT NULL,
    [Name]        NVARCHAR (15) NOT NULL,
    [Description] NTEXT         NULL,
    [Picture]     IMAGE         NULL,
    [CreatedDate] DATETIME      NULL,
    [UserId]      BIGINT        NULL,
    CONSTRAINT [PK_Categories] PRIMARY KEY CLUSTERED ([CategoryId] ASC)
);


GO
PRINT N'Creating [dbo].[Companies]...';


GO
CREATE TABLE [dbo].[Companies] (
    [CompanyId]     INT             IDENTITY (1, 1) NOT NULL,
    [Name]          NVARCHAR (40)   NOT NULL,
    [CompanyNumber] CHAR (8)        NULL,
    [VATNumber]     CHAR (9)        NULL,
    [CreatedDate]   DATETIME        NULL,
    [UserId]        BIGINT          NULL,
    [Website]       NVARCHAR (2083) NULL,
    CONSTRAINT [PK_Companies] PRIMARY KEY CLUSTERED ([CompanyId] ASC)
);


GO
PRINT N'Creating [dbo].[ContactInfo]...';


GO
CREATE TABLE [dbo].[ContactInfo] (
    [ContactInfoId]     BIGINT        NOT NULL,
    [Value]             NVARCHAR (63) NOT NULL,
    [CreatedDate]       DATETIME      NULL,
    [UserId]            BIGINT        NULL,
    [ContactInfoTypeId] TINYINT       NULL,
    [ContactId]         BIGINT        NULL,
    CONSTRAINT [PK_ContactInfo] PRIMARY KEY CLUSTERED ([ContactInfoId] ASC)
);


GO
PRINT N'Creating [dbo].[ContactInfoType]...';


GO
CREATE TABLE [dbo].[ContactInfoType] (
    [ContactInfoTypeId] TINYINT       IDENTITY (1, 1) NOT NULL,
    [Type]              NVARCHAR (63) NOT NULL,
    [CreatedDate]       DATETIME      NULL,
    [UserId]            BIGINT        NULL,
    CONSTRAINT [PK_ContactInfoType] PRIMARY KEY CLUSTERED ([ContactInfoTypeId] ASC)
);


GO
PRINT N'Creating [dbo].[Contacts]...';


GO
CREATE TABLE [dbo].[Contacts] (
    [ContactId]     BIGINT         IDENTITY (1, 1) NOT NULL,
    [PositionTitle] NVARCHAR (50)  NULL,
    [FirstName]     NVARCHAR (31)  NULL,
    [Surname]       NVARCHAR (31)  NULL,
    [MiddleNames]   NVARCHAR (63)  NULL,
    [Title]         NVARCHAR (30)  NULL,
    [PhotoPath]     NVARCHAR (255) NULL,
    [Photo]         IMAGE          NULL,
    [CompanyId]     INT            NOT NULL,
    [GenderId]      TINYINT        NOT NULL,
    [CreatedDate]   DATETIME       NULL,
    [UserId]        BIGINT         NULL,
    [ContactTypeId] TINYINT        NULL,
    [Id]            NVARCHAR (150) NULL,
    CONSTRAINT [PK_Contact] PRIMARY KEY CLUSTERED ([ContactId] ASC)
);


GO
PRINT N'Creating [dbo].[ContactType]...';


GO
CREATE TABLE [dbo].[ContactType] (
    [ContactTypeId] TINYINT    NOT NULL,
    [Value]         NCHAR (15) NOT NULL,
    [CreatedDate]   DATETIME   NOT NULL,
    CONSTRAINT [PK_ContactType] PRIMARY KEY CLUSTERED ([ContactTypeId] ASC)
);


GO
PRINT N'Creating [dbo].[Countries]...';


GO
CREATE TABLE [dbo].[Countries] (
    [CountryId]        SMALLINT    NOT NULL,
    [ISO]              CHAR (127)  NOT NULL,
    [Name]             NCHAR (127) NOT NULL,
    [SentenceCaseName] NCHAR (127) NOT NULL,
    [ISO3]             CHAR (3)    NULL,
    [numcode]          SMALLINT    NULL,
    [phonecode]        INT         NOT NULL,
    [CreatedDate]      DATETIME    NULL,
    [UserId]           BIGINT      NULL,
    CONSTRAINT [PK_Countries] PRIMARY KEY CLUSTERED ([CountryId] ASC)
);


GO
PRINT N'Creating [dbo].[Currencies]...';


GO
CREATE TABLE [dbo].[Currencies] (
    [CurrencyId]     SMALLINT       IDENTITY (1, 1) NOT NULL,
    [Entity]         NVARCHAR (100) NOT NULL,
    [Currency]       NVARCHAR (100) NOT NULL,
    [AlphabeticCode] CHAR (3)       NOT NULL,
    [NumericCode]    CHAR (3)       NULL,
    [MinorUnit]      CHAR (1)       NULL,
    [IsFundYesNo]    BIT            NOT NULL,
    [CreatedDate]    DATETIME       NULL,
    [UserId]         BIGINT         NULL,
    CONSTRAINT [PK_Currencies] PRIMARY KEY CLUSTERED ([CurrencyId] ASC)
);


GO
PRINT N'Creating [dbo].[Drawings]...';


GO
CREATE TABLE [dbo].[Drawings] (
    [DrawingId]        BIGINT          IDENTITY (1, 1) NOT NULL,
    [Name]             NVARCHAR (1023) NOT NULL,
    [FileName]         NVARCHAR (1023) NOT NULL,
    [BlobURL]          NVARCHAR (1023) NOT NULL,
    [ContainerName]    NVARCHAR (31)   NOT NULL,
    [Success]          BIT             NOT NULL,
    [ProjectId]        INT             NOT NULL,
    [ProfileVersionId] INT             NOT NULL,
    [AzureConfidence]  DECIMAL (3, 2)  NULL,
    [GoogleConfidence] DECIMAL (3, 2)  NULL,
    [AmazonConfidence] DECIMAL (3, 2)  NULL,
    [Processed]        BIT             NOT NULL,
    [CreatedDate]      DATETIME        NULL,
    [UserId]           BIGINT          NULL,
    [Type]             NVARCHAR (7)    NULL,
    [UploadDuration]   TIME (5)        NULL,
    CONSTRAINT [PK_Drawing] PRIMARY KEY CLUSTERED ([DrawingId] ASC)
);


GO
PRINT N'Creating [dbo].[DrawingsVTemplates]...';


GO
CREATE TABLE [dbo].[DrawingsVTemplates] (
    [DrawVTempId]        BIGINT           IDENTITY (1, 1) NOT NULL,
    [ProfileAttributeId] BIGINT           NOT NULL,
    [DrawingId]          BIGINT           NOT NULL,
    [PropertyId]         UNIQUEIDENTIFIER NOT NULL,
    CONSTRAINT [PK_DrawingsVTemplates] PRIMARY KEY CLUSTERED ([DrawVTempId] ASC)
);


GO
PRINT N'Creating [dbo].[Employees]...';


GO
CREATE TABLE [dbo].[Employees] (
    [EmployeeId]      BIGINT         NOT NULL,
    [FirstName]       NVARCHAR (31)  NOT NULL,
    [MiddleNames]     NVARCHAR (63)  NULL,
    [Surname]         NVARCHAR (31)  NOT NULL,
    [Title]           NVARCHAR (51)  NULL,
    [TitleOfCourtesy] NVARCHAR (31)  NULL,
    [JobTitle]        NVARCHAR (63)  NULL,
    [BirthDate]       DATETIME       NULL,
    [HireDate]        DATETIME       NULL,
    [Notes]           NTEXT          NULL,
    [ReportsTo]       INT            NULL,
    [Photo]           IMAGE          NULL,
    [PhotoPath]       NVARCHAR (255) NULL,
    [GenderId]        TINYINT        NULL,
    [CreatedDate]     DATETIME       NULL,
    CONSTRAINT [PK_Employees] PRIMARY KEY CLUSTERED ([EmployeeId] ASC)
);


GO
PRINT N'Creating [dbo].[EmployeeTerritories]...';


GO
CREATE TABLE [dbo].[EmployeeTerritories] (
    [EmployeeId]  INT           NOT NULL,
    [TerritoryId] NVARCHAR (20) NOT NULL,
    [CreatedDate] DATETIME      NULL,
    [UserId]      BIGINT        NULL,
    CONSTRAINT [PK_EmployeeTerritories] PRIMARY KEY CLUSTERED ([EmployeeId] ASC, [TerritoryId] ASC)
);


GO
PRINT N'Creating [dbo].[FunctionAppURLs]...';


GO
CREATE TABLE [dbo].[FunctionAppURLs] (
    [FunctionAppURLId] BIGINT         IDENTITY (1, 1) NOT NULL,
    [FunctionName]     NVARCHAR (127) NOT NULL,
    [URL]              NVARCHAR (511) NOT NULL,
    [CompanyId]        INT            NOT NULL,
    CONSTRAINT [PK_FunctionAppURLId] PRIMARY KEY CLUSTERED ([FunctionAppURLId] ASC)
);


GO
PRINT N'Creating [dbo].[Genders]...';


GO
CREATE TABLE [dbo].[Genders] (
    [GenderId]    TINYINT       NOT NULL,
    [Type]        NVARCHAR (15) NOT NULL,
    [CreatedDate] DATETIME      NULL,
    [UserId]      BIGINT        NULL,
    CONSTRAINT [PK_Gender] PRIMARY KEY CLUSTERED ([GenderId] ASC)
);


GO
PRINT N'Creating [dbo].[GoogleLanguages]...';


GO
CREATE TABLE [dbo].[GoogleLanguages] (
    [GoogleLanguageId] TINYINT        NOT NULL,
    [Name]             NVARCHAR (15)  NOT NULL,
    [Code]             NCHAR (3)      NOT NULL,
    [Notes]            NVARCHAR (127) NULL,
    CONSTRAINT [PK_GoogleLanguage] PRIMARY KEY CLUSTERED ([GoogleLanguageId] ASC)
);


GO
PRINT N'Creating [dbo].[OrderDetails]...';


GO
CREATE TABLE [dbo].[OrderDetails] (
    [OrderId]     INT      NOT NULL,
    [ProductId]   INT      NOT NULL,
    [UnitPrice]   MONEY    NOT NULL,
    [Quantity]    SMALLINT NOT NULL,
    [Discount]    REAL     NOT NULL,
    [CreatedDate] DATETIME NULL,
    [UserId]      BIGINT   NULL,
    CONSTRAINT [PK_Order_Details] PRIMARY KEY CLUSTERED ([OrderId] ASC, [ProductId] ASC)
);


GO
PRINT N'Creating [dbo].[Orders]...';


GO
CREATE TABLE [dbo].[Orders] (
    [OrderId]        INT           IDENTITY (1, 1) NOT NULL,
    [CompanyId]      INT           NULL,
    [EmployeeId]     INT           NULL,
    [OrderDate]      DATETIME      NULL,
    [RequiredDate]   DATETIME      NULL,
    [ShippedDate]    DATETIME      NULL,
    [ShipVia]        INT           NULL,
    [Freight]        MONEY         NULL,
    [ShipName]       NVARCHAR (40) NULL,
    [ShipAddress]    NVARCHAR (60) NULL,
    [ShipCity]       NVARCHAR (15) NULL,
    [ShipRegion]     NVARCHAR (15) NULL,
    [ShipPostalCode] NVARCHAR (10) NULL,
    [ShipCountry]    NVARCHAR (15) NULL,
    [CreatedDate]    DATETIME      NULL,
    [UserId]         BIGINT        NULL,
    CONSTRAINT [PK_Orders] PRIMARY KEY CLUSTERED ([OrderId] ASC)
);


GO
PRINT N'Creating [dbo].[PaperSizes]...';


GO
CREATE TABLE [dbo].[PaperSizes] (
    [PaperSizeId]    TINYINT        IDENTITY (1, 1) NOT NULL,
    [Name]           NVARCHAR (15)  NOT NULL,
    [PixelWidth]     INT            NOT NULL,
    [PixelHeight]    INT            NOT NULL,
    [PhysicalWidth]  DECIMAL (6, 1) NULL,
    [PhysicalHeight] DECIMAL (6, 1) NULL,
    [CreatedDate]    DATETIME       NULL,
    [UserId]         BIGINT         NULL,
    CONSTRAINT [PK_PaperSize] PRIMARY KEY CLUSTERED ([PaperSizeId] ASC)
);


GO
PRINT N'Creating [dbo].[Products]...';


GO
CREATE TABLE [dbo].[Products] (
    [ProductId]       INT           IDENTITY (1, 1) NOT NULL,
    [Name]            NVARCHAR (63) NOT NULL,
    [SupplierId]      INT           NULL,
    [CategoryId]      INT           NULL,
    [QuantityPerUnit] NVARCHAR (31) NULL,
    [UnitPrice]       MONEY         NULL,
    [UnitsInStock]    SMALLINT      NULL,
    [UnitsOnOrder]    SMALLINT      NULL,
    [ReorderLevel]    SMALLINT      NULL,
    [Discontinued]    BIT           NOT NULL,
    [CreatedDate]     DATETIME      NULL,
    [UserId]          BIGINT        NULL,
    CONSTRAINT [PK_Products] PRIMARY KEY CLUSTERED ([ProductId] ASC)
);


GO
PRINT N'Creating [dbo].[ProfileAttributes]...';


GO
CREATE TABLE [dbo].[ProfileAttributes] (
    [ProfileAttributeId] BIGINT         IDENTITY (1, 1) NOT NULL,
    [Name]               NVARCHAR (255) NOT NULL,
    [NameX]              INT            NOT NULL,
    [NameY]              INT            NOT NULL,
    [NameWidth]          SMALLINT       NOT NULL,
    [NameHeight]         SMALLINT       NOT NULL,
    [PaperSizeId]        TINYINT        NOT NULL,
    [BlockPositionId]    TINYINT        NOT NULL,
    [ProfileVersionId]   INT            NOT NULL,
    [CreatedDate]        DATETIME       NULL,
    [UserId]             BIGINT         NULL,
    [Value]              NVARCHAR (MAX) NULL,
    [ValueX]             INT            NULL,
    [ValueY]             INT            NULL,
    [ValueWidth]         SMALLINT       NULL,
    [ValueHeight]        SMALLINT       NULL,
    CONSTRAINT [PK_ProfileAttribute] PRIMARY KEY CLUSTERED ([ProfileAttributeId] ASC)
);


GO
PRINT N'Creating [dbo].[ProfileVersions]...';


GO
CREATE TABLE [dbo].[ProfileVersions] (
    [ProfileVersionId] INT             IDENTITY (1, 1) NOT NULL,
    [Name]             NVARCHAR (1023) NOT NULL,
    [ProjectId]        INT             NOT NULL,
    [Image]            IMAGE           NULL,
    [Width]            INT             NULL,
    [Height]           INT             NULL,
    [CreatedDate]      DATETIME        NULL,
    [UserId]           BIGINT          NULL,
    [WidthOriginal]    INT             NULL,
    [HeightOriginal]   INT             NULL,
    [X]                INT             NULL,
    [Y]                INT             NULL,
    CONSTRAINT [PK_ProfileVersionId] PRIMARY KEY CLUSTERED ([ProfileVersionId] ASC)
);


GO
PRINT N'Creating [dbo].[Projects]...';


GO
CREATE TABLE [dbo].[Projects] (
    [ProjectId]   INT             IDENTITY (1, 1) NOT NULL,
    [Name]        NVARCHAR (1024) NOT NULL,
    [CompanyId]   INT             NOT NULL,
    [CreatedDate] DATETIME        NULL,
    [UserId]      BIGINT          NULL,
    CONSTRAINT [PK_ProjectId] PRIMARY KEY CLUSTERED ([ProjectId] ASC)
);


GO
PRINT N'Creating [dbo].[Properties]...';


GO
CREATE TABLE [dbo].[Properties] (
    [PropertyId]          UNIQUEIDENTIFIER NOT NULL,
    [Value]               NVARCHAR (MAX)   NOT NULL,
    [CreatedDate]         DATETIME         NULL,
    [UserId]              BIGINT           NULL,
    [MicrosoftConfidence] DECIMAL (3, 2)   NOT NULL,
    [GoogleConfidence]    DECIMAL (3, 2)   NULL,
    [AmazonConfidence]    DECIMAL (3, 2)   NULL,
    [ClarifaiConfidence]  DECIMAL (3, 2)   NULL,
    [IBMConfidence]       DECIMAL (3, 2)   NULL,
    [ManuallyChecked]     BIT              NULL,
    [GoogleLanguageId]    TINYINT          NULL,
    CONSTRAINT [PK_Property] PRIMARY KEY CLUSTERED ([PropertyId] ASC)
);


GO
PRINT N'Creating [dbo].[DF_Order_Details_UnitPrice]...';


GO
ALTER TABLE [dbo].[OrderDetails]
    ADD CONSTRAINT [DF_Order_Details_UnitPrice] DEFAULT ((0)) FOR [UnitPrice];


GO
PRINT N'Creating [dbo].[DF_Order_Details_Quantity]...';


GO
ALTER TABLE [dbo].[OrderDetails]
    ADD CONSTRAINT [DF_Order_Details_Quantity] DEFAULT ((1)) FOR [Quantity];


GO
PRINT N'Creating [dbo].[DF_Order_Details_Discount]...';


GO
ALTER TABLE [dbo].[OrderDetails]
    ADD CONSTRAINT [DF_Order_Details_Discount] DEFAULT ((0)) FOR [Discount];


GO
PRINT N'Creating [dbo].[DF_Orders_Freight]...';


GO
ALTER TABLE [dbo].[Orders]
    ADD CONSTRAINT [DF_Orders_Freight] DEFAULT ((0)) FOR [Freight];


GO
PRINT N'Creating [dbo].[FK_Addresses_Companies]...';


GO
ALTER TABLE [dbo].[Addresses] WITH NOCHECK
    ADD CONSTRAINT [FK_Addresses_Companies] FOREIGN KEY ([CompanyId]) REFERENCES [dbo].[Companies] ([CompanyId]) ON DELETE CASCADE ON UPDATE CASCADE;


GO
PRINT N'Creating [dbo].[FK_Addresses_Contacts]...';


GO
ALTER TABLE [dbo].[Addresses] WITH NOCHECK
    ADD CONSTRAINT [FK_Addresses_Contacts] FOREIGN KEY ([ContactId]) REFERENCES [dbo].[Contacts] ([ContactId]);


GO
PRINT N'Creating [dbo].[FK_Addresses_Countries]...';


GO
ALTER TABLE [dbo].[Addresses] WITH NOCHECK
    ADD CONSTRAINT [FK_Addresses_Countries] FOREIGN KEY ([CountryId]) REFERENCES [dbo].[Countries] ([CountryId]);


GO
PRINT N'Creating [dbo].[FK_AspNetRoleClaims_AspNetRoles_RoleId]...';


GO
ALTER TABLE [dbo].[AspNetRoleClaims] WITH NOCHECK
    ADD CONSTRAINT [FK_AspNetRoleClaims_AspNetRoles_RoleId] FOREIGN KEY ([RoleId]) REFERENCES [dbo].[AspNetRoles] ([Id]) ON DELETE CASCADE;


GO
PRINT N'Creating [dbo].[FK_AspNetUserClaims_AspNetUsers_UserId]...';


GO
ALTER TABLE [dbo].[AspNetUserClaims] WITH NOCHECK
    ADD CONSTRAINT [FK_AspNetUserClaims_AspNetUsers_UserId] FOREIGN KEY ([UserId]) REFERENCES [dbo].[AspNetUsers] ([Id]) ON DELETE CASCADE;


GO
PRINT N'Creating [dbo].[FK_AspNetUserLogins_AspNetUsers_UserId]...';


GO
ALTER TABLE [dbo].[AspNetUserLogins] WITH NOCHECK
    ADD CONSTRAINT [FK_AspNetUserLogins_AspNetUsers_UserId] FOREIGN KEY ([UserId]) REFERENCES [dbo].[AspNetUsers] ([Id]) ON DELETE CASCADE;


GO
PRINT N'Creating [dbo].[FK_AspNetUserRoles_AspNetRoles_RoleId]...';


GO
ALTER TABLE [dbo].[AspNetUserRoles] WITH NOCHECK
    ADD CONSTRAINT [FK_AspNetUserRoles_AspNetRoles_RoleId] FOREIGN KEY ([RoleId]) REFERENCES [dbo].[AspNetRoles] ([Id]) ON DELETE CASCADE;


GO
PRINT N'Creating [dbo].[FK_AspNetUserRoles_AspNetUsers_UserId]...';


GO
ALTER TABLE [dbo].[AspNetUserRoles] WITH NOCHECK
    ADD CONSTRAINT [FK_AspNetUserRoles_AspNetUsers_UserId] FOREIGN KEY ([UserId]) REFERENCES [dbo].[AspNetUsers] ([Id]) ON DELETE CASCADE;


GO
PRINT N'Creating [dbo].[FK_ContactInfo_ContactInfoType]...';


GO
ALTER TABLE [dbo].[ContactInfo] WITH NOCHECK
    ADD CONSTRAINT [FK_ContactInfo_ContactInfoType] FOREIGN KEY ([ContactInfoTypeId]) REFERENCES [dbo].[ContactInfoType] ([ContactInfoTypeId]);


GO
PRINT N'Creating [dbo].[FK_ContactInfo_Contacts]...';


GO
ALTER TABLE [dbo].[ContactInfo] WITH NOCHECK
    ADD CONSTRAINT [FK_ContactInfo_Contacts] FOREIGN KEY ([ContactId]) REFERENCES [dbo].[Contacts] ([ContactId]) ON DELETE CASCADE ON UPDATE CASCADE;


GO
PRINT N'Creating [dbo].[FK_Contacts_AspNetUsers]...';


GO
ALTER TABLE [dbo].[Contacts] WITH NOCHECK
    ADD CONSTRAINT [FK_Contacts_AspNetUsers] FOREIGN KEY ([Id]) REFERENCES [dbo].[AspNetUsers] ([Id]);


GO
PRINT N'Creating [dbo].[FK_Contacts_Companies]...';


GO
ALTER TABLE [dbo].[Contacts] WITH NOCHECK
    ADD CONSTRAINT [FK_Contacts_Companies] FOREIGN KEY ([CompanyId]) REFERENCES [dbo].[Companies] ([CompanyId]) ON DELETE CASCADE ON UPDATE CASCADE;


GO
PRINT N'Creating [dbo].[FK_Contacts_ContactType]...';


GO
ALTER TABLE [dbo].[Contacts] WITH NOCHECK
    ADD CONSTRAINT [FK_Contacts_ContactType] FOREIGN KEY ([ContactTypeId]) REFERENCES [dbo].[ContactType] ([ContactTypeId]) ON DELETE CASCADE ON UPDATE CASCADE;


GO
PRINT N'Creating [dbo].[FK_Contacts_Gender]...';


GO
ALTER TABLE [dbo].[Contacts] WITH NOCHECK
    ADD CONSTRAINT [FK_Contacts_Gender] FOREIGN KEY ([GenderId]) REFERENCES [dbo].[Genders] ([GenderId]) ON DELETE CASCADE ON UPDATE CASCADE;


GO
PRINT N'Creating [dbo].[FK_Drawings_Projects]...';


GO
ALTER TABLE [dbo].[Drawings] WITH NOCHECK
    ADD CONSTRAINT [FK_Drawings_Projects] FOREIGN KEY ([ProjectId]) REFERENCES [dbo].[Projects] ([ProjectId]);


GO
PRINT N'Creating [dbo].[FK_DrawingsVTemplates_Drawings]...';


GO
ALTER TABLE [dbo].[DrawingsVTemplates] WITH NOCHECK
    ADD CONSTRAINT [FK_DrawingsVTemplates_Drawings] FOREIGN KEY ([DrawingId]) REFERENCES [dbo].[Drawings] ([DrawingId]);


GO
PRINT N'Creating [dbo].[FK_DrawingsVTemplates_ProfileAttributes]...';


GO
ALTER TABLE [dbo].[DrawingsVTemplates] WITH NOCHECK
    ADD CONSTRAINT [FK_DrawingsVTemplates_ProfileAttributes] FOREIGN KEY ([ProfileAttributeId]) REFERENCES [dbo].[ProfileAttributes] ([ProfileAttributeId]) ON DELETE CASCADE ON UPDATE CASCADE;


GO
PRINT N'Creating [dbo].[FK_DrawingsVTemplates_Properties]...';


GO
ALTER TABLE [dbo].[DrawingsVTemplates] WITH NOCHECK
    ADD CONSTRAINT [FK_DrawingsVTemplates_Properties] FOREIGN KEY ([PropertyId]) REFERENCES [dbo].[Properties] ([PropertyId]) ON DELETE CASCADE ON UPDATE CASCADE;


GO
PRINT N'Creating [dbo].[FK_Employees_Gender]...';


GO
ALTER TABLE [dbo].[Employees] WITH NOCHECK
    ADD CONSTRAINT [FK_Employees_Gender] FOREIGN KEY ([GenderId]) REFERENCES [dbo].[Genders] ([GenderId]);


GO
PRINT N'Creating [dbo].[FK_Company]...';


GO
ALTER TABLE [dbo].[FunctionAppURLs] WITH NOCHECK
    ADD CONSTRAINT [FK_Company] FOREIGN KEY ([CompanyId]) REFERENCES [dbo].[Companies] ([CompanyId]);


GO
PRINT N'Creating [dbo].[FK_Order_Details_Orders]...';


GO
ALTER TABLE [dbo].[OrderDetails] WITH NOCHECK
    ADD CONSTRAINT [FK_Order_Details_Orders] FOREIGN KEY ([OrderId]) REFERENCES [dbo].[Orders] ([OrderId]);


GO
PRINT N'Creating [dbo].[FK_Orders_Companies]...';


GO
ALTER TABLE [dbo].[Orders] WITH NOCHECK
    ADD CONSTRAINT [FK_Orders_Companies] FOREIGN KEY ([CompanyId]) REFERENCES [dbo].[Companies] ([CompanyId]);


GO
PRINT N'Creating [dbo].[FK_ProfileAttribute_BlockPosition]...';


GO
ALTER TABLE [dbo].[ProfileAttributes] WITH NOCHECK
    ADD CONSTRAINT [FK_ProfileAttribute_BlockPosition] FOREIGN KEY ([BlockPositionId]) REFERENCES [dbo].[BlockPositions] ([BlockPositionId]) ON DELETE CASCADE ON UPDATE CASCADE;


GO
PRINT N'Creating [dbo].[FK_ProfileAttribute_PaperSize]...';


GO
ALTER TABLE [dbo].[ProfileAttributes] WITH NOCHECK
    ADD CONSTRAINT [FK_ProfileAttribute_PaperSize] FOREIGN KEY ([PaperSizeId]) REFERENCES [dbo].[PaperSizes] ([PaperSizeId]) ON DELETE CASCADE ON UPDATE CASCADE;


GO
PRINT N'Creating [dbo].[FK_ProfileAttribute_ProfileVersion]...';


GO
ALTER TABLE [dbo].[ProfileAttributes] WITH NOCHECK
    ADD CONSTRAINT [FK_ProfileAttribute_ProfileVersion] FOREIGN KEY ([ProfileVersionId]) REFERENCES [dbo].[ProfileVersions] ([ProfileVersionId]) ON DELETE CASCADE ON UPDATE CASCADE;


GO
PRINT N'Creating [dbo].[FK_ProfileVersion_Projects]...';


GO
ALTER TABLE [dbo].[ProfileVersions] WITH NOCHECK
    ADD CONSTRAINT [FK_ProfileVersion_Projects] FOREIGN KEY ([ProjectId]) REFERENCES [dbo].[Projects] ([ProjectId]) ON DELETE CASCADE ON UPDATE CASCADE;


GO
PRINT N'Creating [dbo].[FK_Projects_Companies]...';


GO
ALTER TABLE [dbo].[Projects] WITH NOCHECK
    ADD CONSTRAINT [FK_Projects_Companies] FOREIGN KEY ([CompanyId]) REFERENCES [dbo].[Companies] ([CompanyId]) ON DELETE CASCADE ON UPDATE CASCADE;


GO
PRINT N'Creating [dbo].[FK_Properties_GoogleLanguage]...';


GO
ALTER TABLE [dbo].[Properties] WITH NOCHECK
    ADD CONSTRAINT [FK_Properties_GoogleLanguage] FOREIGN KEY ([GoogleLanguageId]) REFERENCES [dbo].[GoogleLanguages] ([GoogleLanguageId]);


GO
PRINT N'Creating [dbo].[CK_Birthdate]...';


GO
ALTER TABLE [dbo].[Employees] WITH NOCHECK
    ADD CONSTRAINT [CK_Birthdate] CHECK ([BirthDate]<getdate());


GO
PRINT N'Creating [dbo].[CK_Discount]...';


GO
ALTER TABLE [dbo].[OrderDetails] WITH NOCHECK
    ADD CONSTRAINT [CK_Discount] CHECK ([Discount]>=(0) AND [Discount]<=(1));


GO
PRINT N'Creating [dbo].[CK_Quantity]...';


GO
ALTER TABLE [dbo].[OrderDetails] WITH NOCHECK
    ADD CONSTRAINT [CK_Quantity] CHECK ([Quantity]>(0));


GO
PRINT N'Creating [dbo].[CK_UnitPrice]...';


GO
ALTER TABLE [dbo].[OrderDetails] WITH NOCHECK
    ADD CONSTRAINT [CK_UnitPrice] CHECK ([UnitPrice]>=(0));


GO
-- Refactoring step to update target server with deployed transaction logs

IF OBJECT_ID(N'dbo.__RefactorLog') IS NULL
BEGIN
    CREATE TABLE [dbo].[__RefactorLog] (OperationKey UNIQUEIDENTIFIER NOT NULL PRIMARY KEY)
    EXEC sp_addextendedproperty N'microsoft_database_tools_support', N'refactoring log', N'schema', N'dbo', N'table', N'__RefactorLog'
END
GO
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '28b2058c-c28f-49b5-a08b-8b46ca9d8108')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('28b2058c-c28f-49b5-a08b-8b46ca9d8108')
IF NOT EXISTS (SELECT OperationKey FROM [dbo].[__RefactorLog] WHERE OperationKey = '9dbddb34-76dd-4630-8519-0e8ebc1faeb2')
INSERT INTO [dbo].[__RefactorLog] (OperationKey) values ('9dbddb34-76dd-4630-8519-0e8ebc1faeb2')

GO

GO
PRINT N'Checking existing data against newly created constraints';


GO
USE [$(DatabaseName)];


GO
ALTER TABLE [dbo].[Addresses] WITH CHECK CHECK CONSTRAINT [FK_Addresses_Companies];

ALTER TABLE [dbo].[Addresses] WITH CHECK CHECK CONSTRAINT [FK_Addresses_Contacts];

ALTER TABLE [dbo].[Addresses] WITH CHECK CHECK CONSTRAINT [FK_Addresses_Countries];

ALTER TABLE [dbo].[AspNetRoleClaims] WITH CHECK CHECK CONSTRAINT [FK_AspNetRoleClaims_AspNetRoles_RoleId];

ALTER TABLE [dbo].[AspNetUserClaims] WITH CHECK CHECK CONSTRAINT [FK_AspNetUserClaims_AspNetUsers_UserId];

ALTER TABLE [dbo].[AspNetUserLogins] WITH CHECK CHECK CONSTRAINT [FK_AspNetUserLogins_AspNetUsers_UserId];

ALTER TABLE [dbo].[AspNetUserRoles] WITH CHECK CHECK CONSTRAINT [FK_AspNetUserRoles_AspNetRoles_RoleId];

ALTER TABLE [dbo].[AspNetUserRoles] WITH CHECK CHECK CONSTRAINT [FK_AspNetUserRoles_AspNetUsers_UserId];

ALTER TABLE [dbo].[ContactInfo] WITH CHECK CHECK CONSTRAINT [FK_ContactInfo_ContactInfoType];

ALTER TABLE [dbo].[ContactInfo] WITH CHECK CHECK CONSTRAINT [FK_ContactInfo_Contacts];

ALTER TABLE [dbo].[Contacts] WITH CHECK CHECK CONSTRAINT [FK_Contacts_AspNetUsers];

ALTER TABLE [dbo].[Contacts] WITH CHECK CHECK CONSTRAINT [FK_Contacts_Companies];

ALTER TABLE [dbo].[Contacts] WITH CHECK CHECK CONSTRAINT [FK_Contacts_ContactType];

ALTER TABLE [dbo].[Contacts] WITH CHECK CHECK CONSTRAINT [FK_Contacts_Gender];

ALTER TABLE [dbo].[Drawings] WITH CHECK CHECK CONSTRAINT [FK_Drawings_Projects];

ALTER TABLE [dbo].[DrawingsVTemplates] WITH CHECK CHECK CONSTRAINT [FK_DrawingsVTemplates_Drawings];

ALTER TABLE [dbo].[DrawingsVTemplates] WITH CHECK CHECK CONSTRAINT [FK_DrawingsVTemplates_ProfileAttributes];

ALTER TABLE [dbo].[DrawingsVTemplates] WITH CHECK CHECK CONSTRAINT [FK_DrawingsVTemplates_Properties];

ALTER TABLE [dbo].[Employees] WITH CHECK CHECK CONSTRAINT [FK_Employees_Gender];

ALTER TABLE [dbo].[FunctionAppURLs] WITH CHECK CHECK CONSTRAINT [FK_Company];

ALTER TABLE [dbo].[OrderDetails] WITH CHECK CHECK CONSTRAINT [FK_Order_Details_Orders];

ALTER TABLE [dbo].[Orders] WITH CHECK CHECK CONSTRAINT [FK_Orders_Companies];

ALTER TABLE [dbo].[ProfileAttributes] WITH CHECK CHECK CONSTRAINT [FK_ProfileAttribute_BlockPosition];

ALTER TABLE [dbo].[ProfileAttributes] WITH CHECK CHECK CONSTRAINT [FK_ProfileAttribute_PaperSize];

ALTER TABLE [dbo].[ProfileAttributes] WITH CHECK CHECK CONSTRAINT [FK_ProfileAttribute_ProfileVersion];

ALTER TABLE [dbo].[ProfileVersions] WITH CHECK CHECK CONSTRAINT [FK_ProfileVersion_Projects];

ALTER TABLE [dbo].[Projects] WITH CHECK CHECK CONSTRAINT [FK_Projects_Companies];

ALTER TABLE [dbo].[Properties] WITH CHECK CHECK CONSTRAINT [FK_Properties_GoogleLanguage];

ALTER TABLE [dbo].[Employees] WITH CHECK CHECK CONSTRAINT [CK_Birthdate];

ALTER TABLE [dbo].[OrderDetails] WITH CHECK CHECK CONSTRAINT [CK_Discount];

ALTER TABLE [dbo].[OrderDetails] WITH CHECK CHECK CONSTRAINT [CK_Quantity];

ALTER TABLE [dbo].[OrderDetails] WITH CHECK CHECK CONSTRAINT [CK_UnitPrice];


GO
PRINT N'Update complete.';


GO
